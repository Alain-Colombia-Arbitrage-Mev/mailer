import{q as de,h as ue,r as i,E as ce,e as me,z as pe,c as u,a as t,k as $,b as v,s as n,d as x,t as p,l as j,F as C,g as E,v as S,I as V,j as M,x as z,G as ge,m as T,D as I,o as c}from"#entry";import{u as fe}from"./C4JpkZNp.js";import{r as be}from"./17oaNzG6.js";import{r as F}from"./CesKVqSv.js";import{r as ve}from"./DBrhDGOf.js";import{r as U}from"./DWNj0d99.js";import{r as xe}from"./DZycjyJO.js";import{r as ye}from"./BAcWvHoW.js";import"./DMoW-9xf.js";const he={class:"min-h-screen bg-gray-50"},we={class:"bg-white shadow-sm border-b border-gray-200"},ke={class:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8"},_e={class:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-4 sm:py-6 space-y-4 sm:space-y-0"},je={class:"flex items-center"},Ce={class:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3"},Ee=["disabled"],Me=["disabled"],Te={class:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8"},Le={class:"grid grid-cols-1 xl:grid-cols-4 gap-6 lg:gap-8"},De={class:"xl:col-span-3"},He={class:"bg-white shadow-sm rounded-xl border border-gray-200"},$e={class:"p-4 sm:p-6 space-y-6"},Se={class:"flex flex-wrap gap-2 p-3 border border-gray-300 rounded-md min-h-[42px] focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500"},qe=["onClick"],Be=["onKeydown"],Pe=["value"],Re={class:"border border-gray-300 rounded-md"},Ae={class:"flex items-center space-x-2 px-3 py-2 border-b border-gray-200 bg-gray-50"},Ve={class:"relative"},ze={key:0},Ie={class:"border border-gray-200 rounded-md p-4 bg-gray-50 max-h-60 overflow-y-auto"},Fe=["innerHTML"],Ue={class:"xl:col-span-1 space-y-6"},Ne={class:"bg-white shadow-sm rounded-xl border border-gray-200"},Ge={class:"p-4"},Ke={key:0,class:"mt-4 space-y-2"},Oe={class:"flex items-center space-x-2"},Je={class:"text-sm font-medium text-gray-900"},Qe={class:"text-xs text-gray-500"},We=["onClick"],Xe={class:"bg-white shadow-sm rounded-xl border border-gray-200"},Ye={class:"p-4 space-y-2"},Ze=["onClick"],et={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},tt={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},st={class:"mt-3 text-center"},ot={class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100"},nt={class:"mt-2 px-7 py-3"},lt={class:"text-sm text-gray-500"},at={class:"mt-4 text-left bg-gray-50 p-3 rounded"},rt={class:"text-xs text-gray-600"},it={class:"text-xs text-gray-600 mt-1"},dt={class:"text-xs text-gray-600 mt-1"},ut={class:"items-center px-4 py-3"},ct={class:"flex space-x-3"},kt=de({__name:"compose-old",setup(mt){const{user:q}=fe(),l=ue({subject:"",content:"",isHtml:!1}),r=i([]),f=i(""),g=i([]),y=i(""),N=i([]),B=i([{id:"welcome",name:"Bienvenida",content:"<h2>¡Bienvenido!</h2><p>Gracias por unirte a nosotros.</p>"},{id:"followup",name:"Seguimiento",content:"<h2>Seguimiento</h2><p>Esperamos tu respuesta.</p>"},{id:"newsletter",name:"Newsletter",content:"<h2>Newsletter</h2><p>Las últimas noticias para ti.</p>"}]),m=i(!1),L=i(!1),D=i(!1),a=i();i(!1);const w=i(!1),h=i(!1),H=i(!1),k=i(!1),P=ce(()=>r.value.length>0&&l.subject.trim()&&l.content.trim()&&!h.value),_=()=>{const s=f.value.trim();if(!s)return;s.split(",").map(o=>o.trim()).filter(o=>o).forEach(o=>{R(o)&&!r.value.includes(o)?(r.value.push(o),console.log("✅ Email agregado:",o)):R(o)?r.value.includes(o)&&console.warn("⚠️ Email duplicado:",o):console.warn("❌ Email inválido:",o)}),f.value=""},G=s=>{r.value.splice(s,1)},R=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),K=s=>{s.target.value.includes(",")&&I(()=>{_()})},O=s=>{s.preventDefault();const e=s.clipboardData?.getData("text")||"";e.trim()&&(f.value=(f.value+e).trim(),(e.includes(",")||e.includes(" ")||e.includes(";"))&&I(()=>{f.value=f.value.replace(/[;\s]+/g,",").replace(/,+/g,","),_()}))},J=()=>{m.value?a.value&&(a.value.innerHTML=l.content):a.value&&(l.content=a.value.innerHTML),m.value=!m.value},Q=()=>{a.value&&!m.value&&(l.content=a.value.innerHTML)},W=()=>{document.execCommand("bold"),L.value=document.queryCommandState("bold")},X=()=>{document.execCommand("italic"),D.value=document.queryCommandState("italic")},Y=()=>{const s=prompt("Ingresa la URL:");s&&document.execCommand("createLink",!1,s)},Z=s=>{setTimeout(()=>{L.value=document.queryCommandState("bold"),D.value=document.queryCommandState("italic")},10)},ee=s=>{s.preventDefault(),H.value=!1;const e=Array.from(s.dataTransfer?.files||[]);A(e)},te=s=>{const e=s.target,o=Array.from(e.files||[]);A(o)},A=s=>{for(const e of s){if(e.size>10*1024*1024){alert(`El archivo ${e.name} es demasiado grande (máximo 10MB)`);continue}g.value.find(o=>o.name===e.name)||g.value.push(e)}},se=s=>{g.value.splice(s,1)},oe=s=>{if(s===0)return"0 Bytes";const e=1024,o=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,d)).toFixed(2))+" "+o[d]},ne=async()=>{if(!y.value){l.content="";return}const s=B.value.find(e=>e.id===y.value);s&&(l.content=s.content,l.isHtml=!0,m.value=!0,a.value&&(a.value.innerHTML=s.content))},le=s=>{l.content=s.content,l.isHtml=!0,m.value=!0,a.value&&(a.value.innerHTML=s.content)},ae=async()=>{w.value=!0;try{console.log("Guardando borrador...",{recipients:r.value,subject:l.subject,content:l.content,attachments:g.value.map(s=>s.name)}),await new Promise(s=>setTimeout(s,1e3)),alert("Borrador guardado exitosamente")}catch(s){console.error("Error guardando borrador:",s),alert("Error al guardar el borrador")}finally{w.value=!1}},re=()=>{P.value&&(k.value=!0)},ie=async()=>{k.value=!1,h.value=!0;try{console.log("Enviando email...",{recipients:r.value,subject:l.subject,content:l.content,attachments:g.value.length});let s;if(g.value.length>0){console.log("📎 Enviando con adjuntos usando FormData...");const e=new FormData;e.append("recipients",JSON.stringify(r.value)),e.append("subject",l.subject),e.append("content",l.content),e.append("isHtml",String(l.isHtml||m.value)),e.append("sender",q.value?.email||"info@be-mindpower.net"),g.value.forEach((o,d)=>{e.append(`attachment_${d}`,o),console.log(`📎 Agregando adjunto: ${o.name}`)}),s=await $fetch("/api/emails/send-with-files",{method:"POST",body:e})}else{console.log("📧 Enviando sin adjuntos...");const e={recipients:r.value,subject:l.subject,content:l.content,isHtml:l.isHtml||m.value,attachments:[],sender:q.value?.email||"info@be-mindpower.net"};s=await $fetch("/api/emails/send",{method:"POST",body:e})}if(s.success)alert("Email enviado exitosamente"),r.value=[],l.subject="",l.content="",g.value=[],a.value&&(a.value.innerHTML="");else throw new Error(s.error||"Error desconocido")}catch(s){console.error("Error enviando email:",s),alert(`Error al enviar el email: ${s.message}`)}finally{h.value=!1}};return me(()=>{document.addEventListener("dragover",e=>e.preventDefault()),document.addEventListener("drop",e=>e.preventDefault());const s=pe();if(s.query.to){const e=s.query.to,o=s.query.name;console.log("📧 Parámetros URL detectados:",{email:e,name:o});const d=e.split(",").map(b=>b.trim()).filter(b=>b);for(const b of d)r.value.includes(b)||(r.value.push(b),console.log("✅ Destinatario agregado desde URL:",b));o&&d.length===1&&console.log("📝 Nombre del destinatario:",o)}if(s.query.subject&&(l.subject=s.query.subject,console.log("📝 Asunto prellenado desde URL:",l.subject)),s.query.body||s.query.content){const e=s.query.body||s.query.content;l.content=e,a.value&&(a.value.innerHTML=e),console.log("📝 Contenido prellenado desde URL")}a.value&&(a.value.innerHTML=l.content)}),(s,e)=>(c(),u("div",he,[t("div",we,[t("div",ke,[t("div",_e,[t("div",je,[t("button",{onClick:e[0]||(e[0]=o=>s.$router.back()),class:"mr-3 p-2 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100 transition-colors"},[v(n(be),{class:"h-5 w-5"})]),e[9]||(e[9]=t("div",null,[t("h1",{class:"text-xl sm:text-2xl font-bold text-gray-900"},"Componer Email"),t("p",{class:"text-sm text-gray-500 mt-1 hidden sm:block"},"Envía emails personales con plantillas y adjuntos")],-1))]),t("div",Ce,[t("button",{onClick:ae,disabled:n(w),class:"inline-flex items-center justify-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 transition-colors"},[v(n(F),{class:"h-4 w-4 mr-2"}),x(" "+p(n(w)?"Guardando...":"Guardar Borrador"),1)],8,Ee),t("button",{onClick:re,disabled:!n(P)||n(h),class:"inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 transition-colors"},[v(n(ve),{class:"h-4 w-4 mr-2"}),x(" "+p(n(h)?"Enviando...":"Enviar Email"),1)],8,Me)])])])]),t("div",Te,[t("div",Le,[t("div",De,[t("div",He,[e[20]||(e[20]=t("div",{class:"px-4 sm:px-6 py-4 border-b border-gray-200"},[t("h2",{class:"text-lg font-semibold text-gray-900"},"Detalles del Email")],-1)),t("div",$e,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Para * ",-1)),t("div",Se,[(c(!0),u(C,null,E(n(r),(o,d)=>(c(),u("div",{key:d,class:"inline-flex items-center px-2 py-1 rounded-md text-sm bg-blue-100 text-blue-800"},[x(p(o)+" ",1),t("button",{onClick:b=>G(d),class:"ml-1 text-blue-600 hover:text-blue-800"},[v(n(U),{class:"h-4 w-4"})],8,qe)]))),128)),j(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>z(f)?f.value=o:null),onKeydown:[V(M(_,["prevent"]),["enter"]),V(M(_,["prevent"]),["comma"])],onInput:K,onPaste:O,type:"email",placeholder:"Agregar email...",class:"flex-1 min-w-[200px] border-none outline-none focus:ring-0"},null,40,Be),[[S,n(f)]])]),e[11]||(e[11]=t("p",{class:"mt-1 text-sm text-gray-500"}," Separa múltiples emails con comas, espacios o presiona Enter. También puedes pegar una lista de emails. ",-1))]),t("div",null,[e[12]||(e[12]=t("label",{for:"subject",class:"block text-sm font-medium text-gray-700 mb-2"}," Asunto * ",-1)),j(t("input",{id:"subject","onUpdate:modelValue":e[2]||(e[2]=o=>n(l).subject=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Escribe el asunto del email..."},null,512),[[S,n(l).subject]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Plantilla ",-1)),j(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>z(y)?y.value=o:null),onChange:ne,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[e[13]||(e[13]=t("option",{value:""},"Sin plantilla (texto plano)",-1)),(c(!0),u(C,null,E(n(N),o=>(c(),u("option",{key:o.id,value:o.id},p(o.name),9,Pe))),128))],544),[[ge,n(y)]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Contenido * ",-1)),t("div",Re,[t("div",Ae,[t("button",{onClick:W,class:T([{"bg-gray-200":n(L)},"p-1 rounded hover:bg-gray-200"]),type:"button"},[...e[15]||(e[15]=[t("strong",null,"B",-1)])],2),t("button",{onClick:X,class:T([{"bg-gray-200":n(D)},"p-1 rounded hover:bg-gray-200"]),type:"button"},[...e[16]||(e[16]=[t("em",null,"I",-1)])],2),t("button",{onClick:Y,class:"p-1 rounded hover:bg-gray-200",type:"button"}," 🔗 "),e[17]||(e[17]=t("div",{class:"border-l border-gray-300 h-6"},null,-1)),t("button",{onClick:J,class:T([{"bg-blue-100 text-blue-700":n(m)},"px-2 py-1 text-sm rounded hover:bg-gray-200"]),type:"button"},p(n(m)?"Visual":"HTML"),3)]),t("div",Ve,[n(m)?j((c(),u("textarea",{key:1,"onUpdate:modelValue":e[4]||(e[4]=o=>n(l).content=o),class:"w-full min-h-[300px] p-4 font-mono text-sm border-none resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Escribe tu HTML aquí..."},null,512)),[[S,n(l).content]]):(c(),u("div",{key:0,ref_key:"editor",ref:a,contenteditable:"true",onInput:Q,onKeydown:Z,class:"min-h-[300px] p-4 focus:outline-none focus:ring-2 focus:ring-blue-500",style:{"white-space":"pre-wrap"}},null,544))])])]),n(l).content&&n(m)?(c(),u("div",ze,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Vista Previa ",-1)),t("div",Ie,[t("div",{innerHTML:n(l).content},null,8,Fe)])])):$("",!0)])])]),t("div",Ue,[t("div",Ne,[e[23]||(e[23]=t("div",{class:"px-4 py-3 border-b border-gray-200"},[t("h3",{class:"text-sm font-semibold text-gray-900"},"Adjuntos")],-1)),t("div",Ge,[t("div",{onDrop:ee,onDragover:e[5]||(e[5]=M(()=>{},["prevent"])),onDragenter:e[6]||(e[6]=M(()=>{},["prevent"])),class:T([{"border-blue-500 bg-blue-50":n(H),"border-gray-300":!n(H)},"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors"]),onClick:e[7]||(e[7]=o=>s.$refs.fileInput.click())},[v(n(xe),{class:"mx-auto h-8 w-8 text-gray-400"}),e[21]||(e[21]=t("p",{class:"mt-2 text-sm text-gray-600"}," Arrastra archivos aquí o haz clic para seleccionar ",-1)),e[22]||(e[22]=t("p",{class:"text-xs text-gray-500 mt-1"}," Máximo 10MB por archivo ",-1))],34),t("input",{ref:"fileInput",type:"file",multiple:"",onChange:te,class:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif,.zip,.rar"},null,544),n(g).length>0?(c(),u("div",Ke,[(c(!0),u(C,null,E(n(g),(o,d)=>(c(),u("div",{key:d,class:"flex items-center justify-between p-2 bg-gray-50 rounded-md"},[t("div",Oe,[v(n(F),{class:"h-4 w-4 text-gray-500"}),t("div",null,[t("p",Je,p(o.name),1),t("p",Qe,p(oe(o.size)),1)])]),t("button",{onClick:b=>se(d),class:"text-red-500 hover:text-red-700"},[v(n(U),{class:"h-4 w-4"})],8,We)]))),128))])):$("",!0)])]),t("div",Xe,[e[24]||(e[24]=t("div",{class:"px-4 py-3 border-b border-gray-200"},[t("h3",{class:"text-sm font-semibold text-gray-900"},"Plantillas Rápidas")],-1)),t("div",Ye,[(c(!0),u(C,null,E(n(B),o=>(c(),u("button",{key:o.id,onClick:d=>le(o),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"},p(o.name),9,Ze))),128))])])])])]),n(k)?(c(),u("div",et,[t("div",tt,[t("div",st,[t("div",ot,[v(n(ye),{class:"h-6 w-6 text-green-600"})]),e[28]||(e[28]=t("h3",{class:"text-lg font-medium text-gray-900 mt-4"},"Confirmar Envío",-1)),t("div",nt,[t("p",lt," ¿Estás seguro de que deseas enviar este email a "+p(n(r).length)+" destinatario(s)? ",1),t("div",at,[t("p",rt,[e[25]||(e[25]=t("strong",null,"Para:",-1)),x(" "+p(n(r).join(", ")),1)]),t("p",it,[e[26]||(e[26]=t("strong",null,"Asunto:",-1)),x(" "+p(n(l).subject),1)]),t("p",dt,[e[27]||(e[27]=t("strong",null,"Adjuntos:",-1)),x(" "+p(n(g).length),1)])])]),t("div",ut,[t("div",ct,[t("button",{onClick:e[8]||(e[8]=o=>k.value=!1),class:"px-4 py-2 bg-gray-300 text-gray-800 text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300"}," Cancelar "),t("button",{onClick:ie,class:"px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"}," Enviar ")])])])])])):$("",!0)]))}});export{kt as default};
