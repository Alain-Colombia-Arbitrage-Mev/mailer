import{c as y,o as g,a as e,r as w,a0 as N,q as re,h as ae,E as X,e as ne,B as le,k as x,t as f,s as t,b as B,d as E,l as z,H,v as V,x as ie,F as K,g as G,m as J,j as Q,J as ce,f as I,y as de}from"#entry";import{u as W}from"./BcbNczkL.js";import{r as ue}from"./DW5NWq0j.js";import{r as me,a as fe}from"./B_OYc0Sc.js";import{r as ge}from"./CVHiCNXI.js";import{r as pe}from"./DZycjyJO.js";import{r as ve}from"./CesKVqSv.js";import{r as be}from"./DBrhDGOf.js";import{r as ye}from"./BAcWvHoW.js";import{r as he}from"./B2LZCxKM.js";import{r as xe}from"./CKFK7sG5.js";import{_ as we}from"./DlAUqK2U.js";function _e(P,h){return g(),y("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13"})])}const Ee=()=>{const{correctSupabaseClient:P}=W(),h=P,p=w(!1),u=w(null),$=async()=>{p.value=!0,u.value=null;try{console.log("📋 Obteniendo contactos de tabla mailing_contacts de Supabase...");const{data:l,error:o}=await h.from("mailing_contacts").select("*").eq("status","active").order("created_at",{ascending:!1});return o?(console.error("❌ Error obteniendo contactos:",o),u.value=o.message,{success:!1,error:o.message,contacts:[]}):(console.log(`✅ Contactos obtenidos: ${l.length}`),{success:!0,contacts:l||[]})}catch(l){return console.error("💥 Error:",l),u.value=l.message,{success:!1,error:l.message,contacts:[]}}finally{p.value=!1}},j=async(l={})=>{p.value=!0,u.value=null;try{console.log("🔍 Obteniendo contactos filtrados:",l);let o=h.from("mailing_contacts").select("*").eq("status","active");l.search&&(o=o.or(`email.ilike.%${l.search}%,first_name.ilike.%${l.search}%,last_name.ilike.%${l.search}%,company.ilike.%${l.search}%`)),l.limit&&(o=o.limit(l.limit)),l.offset&&(o=o.range(l.offset,l.offset+(l.limit||10)-1)),o=o.order("created_at",{ascending:!1});const{data:m,error:C}=await o;return C?(console.error("❌ Error obteniendo contactos filtrados:",C),u.value=C.message,{success:!1,error:C.message,contacts:[]}):(console.log(`✅ Contactos filtrados obtenidos: ${m.length}`),{success:!0,contacts:m||[]})}catch(o){return console.error("💥 Error:",o),u.value=o.message,{success:!1,error:o.message,contacts:[]}}finally{p.value=!1}},D=async l=>{p.value=!0,u.value=null;try{const{data:o,error:m}=await h.from("mailing_contacts").select("*").eq("id",l).single();return m?(console.error("❌ Error obteniendo contacto:",m),u.value=m.message,{success:!1,error:m.message,contact:null}):{success:!0,contact:o}}catch(o){return console.error("💥 Error:",o),u.value=o.message,{success:!1,error:o.message,contact:null}}finally{p.value=!1}},R=async l=>{p.value=!0,u.value=null;try{console.log("➕ Creando contacto:",l.email);const{data:o,error:m}=await h.from("mailing_contacts").insert([{email:l.email,first_name:l.first_name,last_name:l.last_name,phone:l.phone,company:l.company,status:"active",metadata:l.metadata||{},subscribed_at:new Date().toISOString(),created_at:new Date().toISOString()}]).select().single();return m?(console.error("❌ Error creando contacto:",m),u.value=m.message,{success:!1,error:m.message,contact:null}):(console.log("✅ Contacto creado exitosamente"),{success:!0,contact:o})}catch(o){return console.error("💥 Error:",o),u.value=o.message,{success:!1,error:o.message,contact:null}}finally{p.value=!1}},r=async(l,o)=>{p.value=!0,u.value=null;try{console.log("📝 Actualizando contacto:",l);const m={};o.email&&(m.email=o.email),o.first_name&&(m.first_name=o.first_name),o.last_name&&(m.last_name=o.last_name),o.phone&&(m.phone=o.phone),o.company&&(m.company=o.company),o.status&&(m.status=o.status),o.metadata&&(m.metadata=o.metadata);const{data:C,error:a}=await h.from("mailing_contacts").update(m).eq("id",l).select().single();return a?(console.error("❌ Error actualizando contacto:",a),u.value=a.message,{success:!1,error:a.message,contact:null}):(console.log("✅ Contacto actualizado exitosamente"),{success:!0,contact:C})}catch(m){return console.error("💥 Error:",m),u.value=m.message,{success:!1,error:m.message,contact:null}}finally{p.value=!1}},F=async l=>{p.value=!0,u.value=null;try{console.log("🗑️ Eliminando contacto:",l);const{error:o}=await h.from("mailing_contacts").delete().eq("id",l);return o?(console.error("❌ Error eliminando contacto:",o),u.value=o.message,{success:!1,error:o.message}):(console.log("✅ Contacto eliminado exitosamente"),{success:!0})}catch(o){return console.error("💥 Error:",o),u.value=o.message,{success:!1,error:o.message}}finally{p.value=!1}},U=async()=>{try{const{count:l,error:o}=await h.from("mailing_contacts").select("*",{count:"exact",head:!0}).eq("status","active");return o?(console.error("❌ Error obteniendo estadísticas:",o),{success:!1,error:o.message,total:0}):{success:!0,total:l||0}}catch(l){return console.error("💥 Error:",l),{success:!1,error:l.message,total:0}}};return{isLoading:N(p),error:N(u),getAllContacts:$,getContactsFiltered:j,getContactById:D,createContact:R,updateContact:r,deleteContact:F,getContactsStats:U}},Ce=()=>{const{correctSupabaseClient:P}=W(),h=P,p=w(!1),u=w(null),$=w(0),j="email-attachments",D=async(a,v={})=>{p.value=!0,u.value=null,$.value=0;try{const i=v.bucket||j,d=`${Date.now()}-${a.name}`,b=v.path?`${v.path}/${d}`:d;if(console.log(`📤 Subiendo archivo: ${a.name} (${C(a.size)})`),a.size>50*1024*1024)throw new Error("El archivo es demasiado grande (máximo 50MB)");const{data:_,error:T}=await h.storage.from(i).upload(b,a,{cacheControl:"3600",upsert:v.upsert||!0});if(T)return console.error("❌ Error subiendo archivo:",T),u.value=T.message,{success:!1,error:T.message,data:null};$.value=100;const{data:L}=h.storage.from(i).getPublicUrl(b);return console.log(`✅ Archivo subido exitosamente: ${b}`),{success:!0,data:{..._,publicUrl:L.publicUrl,fileName:a.name,fileSize:a.size,mimeType:a.type}}}catch(i){return console.error("💥 Error subiendo archivo:",i),u.value=i.message,{success:!1,error:i.message,data:null}}finally{p.value=!1,$.value=0}},R=async(a,v={})=>{p.value=!0,u.value=null;try{const i=[];let d=0,b=0;console.log(`📤 Subiendo ${a.length} archivos...`);for(let _=0;_<a.length;_++){const T=a[_];$.value=Math.round(_/a.length*100);const L=await D(T,v);i.push({file:T.name,...L}),L.success?d++:b++}return $.value=100,console.log(`✅ Subida completa: ${d} exitosos, ${b} fallidos`),{success:b===0,results:i,summary:{total:a.length,successful:d,failed:b}}}catch(i){return console.error("💥 Error subiendo archivos:",i),u.value=i.message,{success:!1,error:i.message,results:[]}}finally{p.value=!1,$.value=0}},r=async(a,v=j)=>{p.value=!0,u.value=null;try{console.log(`📥 Descargando archivo: ${a}`);const{data:i,error:d}=await h.storage.from(v).download(a);return d?(console.error("❌ Error descargando archivo:",d),u.value=d.message,{success:!1,error:d.message,data:null}):(console.log(`✅ Archivo descargado: ${a}`),{success:!0,data:i})}catch(i){return console.error("💥 Error descargando archivo:",i),u.value=i.message,{success:!1,error:i.message,data:null}}finally{p.value=!1}},F=async(a,v=3600,i=j)=>{try{console.log(`🔗 Creando URL firmada: ${a}`);const{data:d,error:b}=await h.storage.from(i).createSignedUrl(a,v);return b?(console.error("❌ Error creando URL firmada:",b),{success:!1,error:b.message,signedUrl:null}):{success:!0,signedUrl:d.signedUrl}}catch(d){return console.error("💥 Error:",d),{success:!1,error:d.message,signedUrl:null}}},U=async(a="",v=j,i={})=>{p.value=!0,u.value=null;try{console.log(`📋 Listando archivos en: ${v}/${a}`);const{data:d,error:b}=await h.storage.from(v).list(a,{limit:i.limit||100,offset:i.offset||0});return b?(console.error("❌ Error listando archivos:",b),u.value=b.message,{success:!1,error:b.message,files:[]}):{success:!0,files:d||[]}}catch(d){return console.error("💥 Error:",d),u.value=d.message,{success:!1,error:d.message,files:[]}}finally{p.value=!1}},l=async(a,v=j)=>{p.value=!0,u.value=null;try{console.log(`🗑️ Eliminando ${a.length} archivo(s)`);const{data:i,error:d}=await h.storage.from(v).remove(a);return d?(console.error("❌ Error eliminando archivos:",d),u.value=d.message,{success:!1,error:d.message,deleted:[]}):(console.log(`✅ ${i.length} archivo(s) eliminado(s)`),{success:!0,deleted:i})}catch(i){return console.error("💥 Error:",i),u.value=i.message,{success:!1,error:i.message,deleted:[]}}finally{p.value=!1}},o=async(a,v=!1)=>{try{const{data:i}=await h.storage.listBuckets();if(i?.find(T=>T.name===a))return console.log(`✅ Bucket '${a}' ya existe`),{success:!0,exists:!0};console.log(`📦 Creando bucket: ${a}`);const{data:b,error:_}=await h.storage.createBucket(a,{public:v,allowedMimeTypes:["image/*","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/*","video/*","audio/*"],fileSizeLimit:50*1024*1024});return _?(console.error("❌ Error creando bucket:",_),{success:!1,error:_.message,exists:!1}):(console.log(`✅ Bucket '${a}' creado exitosamente`),{success:!0,exists:!1,data:b})}catch(i){return console.error("💥 Error:",i),{success:!1,error:i.message,exists:!1}}},m=async(a,v=j)=>{try{const{data:i,error:d}=await h.storage.from(v).list("",{search:a});return d?{success:!1,error:d.message,info:null}:{success:!0,info:i.find(_=>_.name===a.split("/").pop())}}catch(i){return{success:!1,error:i.message,info:null}}},C=a=>{if(a===0)return"0 Bytes";const v=1024,i=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(a)/Math.log(v));return parseFloat((a/Math.pow(v,d)).toFixed(2))+" "+i[d]};return{isLoading:N(p),error:N(u),uploadProgress:N($),DEFAULT_BUCKET:j,uploadFile:D,uploadFiles:R,downloadFile:r,deleteFiles:l,listFiles:U,getFileInfo:m,createSignedUrl:F,ensureBucket:o,formatFileSize:C}},ke={class:"min-h-screen bg-gray-50"},$e={class:"max-w-4xl mx-auto px-4 py-8"},Se={class:"mb-8"},Te={class:"flex items-center justify-between"},je={class:"flex items-center space-x-3"},Ue={class:"text-sm text-gray-500"},Re={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Me={class:"lg:col-span-2 space-y-6"},Ae={class:"bg-white rounded-lg shadow p-6"},Be={class:"text-lg font-semibold mb-4 flex items-center"},Fe={class:"mb-4 flex space-x-4"},ze={class:"flex items-center"},De={class:"flex items-center"},Le={key:0,class:"space-y-4"},Pe={key:1,class:"space-y-4"},Ne={class:"flex items-center justify-between"},Ve={class:"text-sm font-medium"},qe=["disabled"],Ie={class:"max-h-40 overflow-y-auto border rounded-md"},Oe={key:0,class:"p-4 text-center text-gray-500"},Xe={key:1,class:"p-4 text-center text-gray-500"},He={key:2,class:"space-y-1 p-2"},Ke=["value"],Ge={class:"flex-1"},Je={class:"text-sm font-medium"},Qe={key:0,class:"text-xs text-gray-500"},We={class:"flex items-center justify-between text-sm"},Ye={class:"text-gray-600"},Ze={class:"space-x-2"},es={class:"bg-white rounded-lg shadow p-6"},ss={class:"text-lg font-semibold mb-4 flex items-center"},ts={class:"space-y-4"},os={class:"text-xs text-gray-500 mt-1"},rs={class:"bg-white rounded-lg shadow p-6"},as={class:"text-lg font-semibold mb-4 flex items-center"},ns={class:"ml-2 text-sm font-normal text-gray-500"},ls={class:"text-gray-600 mb-2"},is={key:0,class:"mt-4 space-y-2"},cs={class:"flex items-center flex-1 min-w-0"},ds={class:"min-w-0 flex-1"},us={class:"text-sm font-medium truncate"},ms={class:"text-xs text-gray-500"},fs={key:0,class:"text-green-600 ml-2"},gs={key:1,class:"text-blue-600 ml-2"},ps={key:2,class:"text-red-600 ml-2"},vs=["onClick","disabled"],bs={key:1,class:"mt-4"},ys={class:"text-sm text-gray-600 mb-1"},hs={class:"w-full bg-gray-200 rounded-full h-2"},xs={class:"bg-white rounded-lg shadow p-6"},ws={class:"flex items-center justify-between"},_s={class:"text-sm text-gray-600"},Es={key:0},Cs={key:1},ks={key:2},$s=["disabled"],Ss={key:0},Ts={key:1},js={class:"space-y-6"},Us={class:"bg-white rounded-lg shadow p-6"},Rs={class:"text-sm space-y-2"},Ms={key:0},As={key:1},Bs={class:"bg-white rounded-lg shadow p-6"},Fs={class:"space-y-2 text-sm"},zs={class:"flex justify-between"},Ds={class:"flex justify-between"},Ls={class:"flex justify-between"},Ps={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ns={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},Vs={class:"space-y-2 text-sm mb-6"},qs={class:"flex space-x-3"},Is=["disabled"],Os={key:1,class:"fixed bottom-4 right-4 z-50"},Xs={class:"flex items-center space-x-2"},Hs=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.txt,.csv",Ks=re({__name:"compose-new",setup(P){const h=w({id:"test-user",email:"info@be-mindpower.net",name:"Administrador",isAdmin:!0,source:"bypass-mode"}),{getAllContacts:p,getContactsStats:u,isLoading:$}=Ee(),{uploadFiles:j,formatFileSize:D,uploadProgress:R}=Ce(),r=ae({sendType:"single",singleRecipient:"",selectedRecipients:[],subject:"",content:""}),F=w([]),U=w(""),l=w({total:0}),o=w([]),m=w(!1),C=w(!1),a=w(!1),v=w(!1),i=w(""),d=w("info"),b=X(()=>{if(!U.value)return F.value;const c=U.value.toLowerCase();return F.value.filter(s=>s.email?.toLowerCase().includes(c)||s.name?.toLowerCase().includes(c))}),_=X(()=>{const c=r.sendType==="single"?r.singleRecipient.trim()!=="":r.selectedRecipients.length>0,s=r.subject.trim()!=="",n=r.content.trim()!=="",S=o.value.every(k=>k.uploaded||!k.file);return c&&s&&n&&S&&!a.value}),T=async()=>{try{const[c,s]=await Promise.all([p(),u()]);c.success&&(F.value=c.contacts),s.success&&(l.value={total:s.total})}catch(c){console.error("Error cargando contactos:",c),M("Error cargando contactos","error")}},L=()=>{r.selectedRecipients=b.value.map(c=>c.email)},Y=c=>{const s=c.target;s.files&&(O(Array.from(s.files)),s.value="")},Z=c=>{c.preventDefault(),m.value=!1,c.dataTransfer?.files&&O(Array.from(c.dataTransfer.files))},O=async c=>{const s=c.filter(n=>n.size>52428800?(M(`${n.name} es demasiado grande (max 50MB)`,"error"),!1):o.value.length>=10?(M("Máximo 10 archivos adjuntos","error"),!1):!0);for(const n of s)o.value.push({file:n,fileName:n.name,fileSize:n.size,mimeType:n.type,uploaded:!1,uploading:!1});s.length>0&&await ee(s)},ee=async c=>{try{c.forEach(k=>{const A=o.value.find(q=>q.fileName===k.name);A&&(A.uploading=!0)});const s=await j(c,{bucket:"email-attachments",path:`${h.value?.id||"anonymous"}/${Date.now()}`});s.results?.forEach(k=>{const A=o.value.find(q=>q.fileName===k.file);A&&(A.uploading=!1,k.success?(A.uploaded=!0,A.publicUrl=k.data?.publicUrl):A.error=k.error)});const n=s.results?.filter(k=>k.success).length||0,S=c.length-n;n>0&&M(`${n} archivo(s) subido(s) exitosamente`,"success"),S>0&&M(`Error subiendo ${S} archivo(s)`,"error")}catch(s){console.error("Error subiendo archivos:",s),M("Error subiendo archivos","error"),c.forEach(n=>{const S=o.value.find(k=>k.fileName===n.name);S&&(S.uploading=!1,S.error="Error de subida")})}},se=c=>{o.value.splice(c,1)},te=()=>{_.value&&(C.value=!0)},oe=async()=>{if(!a.value){a.value=!0,C.value=!1;try{const c={sendType:r.sendType,recipients:r.sendType==="single"?[r.singleRecipient]:r.selectedRecipients,subject:r.subject,content:r.content,attachments:o.value.filter(n=>n.uploaded).map(n=>({fileName:n.fileName,publicUrl:n.publicUrl,mimeType:n.mimeType,fileSize:n.fileSize})),sender:h.value?.email},s=await $fetch("/api/emails/send-advanced",{method:"POST",body:c});if(s.success)M(`Email ${r.sendType==="mass"?"masivo":""} enviado exitosamente!`,"success"),r.subject="",r.content="",r.singleRecipient="",r.selectedRecipients=[],o.value=[];else throw new Error(s.error||"Error enviando email")}catch(c){console.error("Error enviando email:",c),M(c.message||"Error enviando email","error")}finally{a.value=!1}}},M=(c,s="info")=>{i.value=c,d.value=s,v.value=!0,setTimeout(()=>{v.value=!1},5e3)};return ne(async()=>{await T();{const c=new URLSearchParams(window.location.search);if(c.get("to")){const s=c.get("to");r.singleRecipient=s}if(c.get("subject")&&(r.subject=c.get("subject")),c.get("body")||c.get("content")){const s=c.get("body")||c.get("content");r.content=s}}}),le({title:"Componer Email - Mailer Be-Mindpower",description:"Componer emails individuales o masivos con archivos adjuntos"}),(c,s)=>(g(),y("div",ke,[e("div",$e,[e("div",Se,[e("div",Te,[s[13]||(s[13]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Componer Email"),e("p",{class:"text-gray-600"},"Envío individual o masivo con archivos adjuntos")],-1)),e("div",je,[e("div",Ue," Usuario: "+f(t(h)?.email),1),e("button",{onClick:s[0]||(s[0]=n=>c.$router.push("/dashboard")),class:"bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300"}," ← Volver ")])])]),e("div",Re,[e("div",Me,[e("div",Ae,[e("h3",Be,[B(t(ue),{class:"h-5 w-5 mr-2 text-blue-600"}),s[14]||(s[14]=E(" Destinatarios ",-1))]),e("div",Fe,[e("label",ze,[z(e("input",{type:"radio","onUpdate:modelValue":s[1]||(s[1]=n=>t(r).sendType=n),value:"single",class:"mr-2"},null,512),[[H,t(r).sendType]]),s[15]||(s[15]=E(" 📧 Envío Individual ",-1))]),e("label",De,[z(e("input",{type:"radio","onUpdate:modelValue":s[2]||(s[2]=n=>t(r).sendType=n),value:"mass",class:"mr-2"},null,512),[[H,t(r).sendType]]),s[16]||(s[16]=E(" 📨 Envío Masivo ",-1))])]),t(r).sendType==="single"?(g(),y("div",Le,[e("div",null,[s[17]||(s[17]=e("label",{class:"block text-sm font-medium mb-2"},"Email del Destinatario:",-1)),z(e("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>t(r).singleRecipient=n),type:"email",placeholder:"ejemplo@correo.com",class:"w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500"},null,512),[[V,t(r).singleRecipient]])])])):x("",!0),t(r).sendType==="mass"?(g(),y("div",Pe,[e("div",Ne,[e("span",Ve," Contactos de Supabase: "+f(t(b).length),1),e("button",{onClick:T,disabled:t($),class:"text-blue-600 hover:text-blue-800 text-sm disabled:opacity-50"},[B(t(me),{class:"h-4 w-4 inline mr-1"}),E(" "+f(t($)?"Cargando...":"Actualizar"),1)],8,qe)]),e("div",null,[z(e("input",{"onUpdate:modelValue":s[4]||(s[4]=n=>ie(U)?U.value=n:null),type:"text",placeholder:"Buscar contactos por email o nombre...",class:"w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500"},null,512),[[V,t(U)]])]),e("div",Ie,[t($)?(g(),y("div",Oe," Cargando contactos... ")):t(b).length===0?(g(),y("div",Xe," No hay contactos disponibles ")):(g(),y("div",He,[(g(!0),y(K,null,G(t(b).slice(0,50),n=>(g(),y("label",{key:n.id,class:"flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer"},[z(e("input",{type:"checkbox",value:n.email,"onUpdate:modelValue":s[5]||(s[5]=S=>t(r).selectedRecipients=S),class:"mr-3"},null,8,Ke),[[de,t(r).selectedRecipients]]),e("div",Ge,[e("div",Je,f(n.email),1),n.name?(g(),y("div",Qe,f(n.name),1)):x("",!0)])]))),128))]))]),e("div",We,[e("span",Ye,f(t(r).selectedRecipients.length)+" seleccionados ",1),e("div",Ze,[e("button",{onClick:L,class:"text-blue-600 hover:text-blue-800"}," Seleccionar Todos "),e("button",{onClick:s[6]||(s[6]=n=>t(r).selectedRecipients=[]),class:"text-red-600 hover:text-red-800"}," Deseleccionar Todos ")])])])):x("",!0)]),e("div",es,[e("h3",ss,[B(t(ge),{class:"h-5 w-5 mr-2 text-blue-600"}),s[18]||(s[18]=E(" Contenido del Email ",-1))]),e("div",ts,[e("div",null,[s[19]||(s[19]=e("label",{class:"block text-sm font-medium mb-2"},"Asunto:",-1)),z(e("input",{"onUpdate:modelValue":s[7]||(s[7]=n=>t(r).subject=n),type:"text",placeholder:"Asunto del email...",class:"w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500"},null,512),[[V,t(r).subject]])]),e("div",null,[s[20]||(s[20]=e("label",{class:"block text-sm font-medium mb-2"},"Mensaje:",-1)),z(e("textarea",{"onUpdate:modelValue":s[8]||(s[8]=n=>t(r).content=n),rows:"12",placeholder:"Escribe tu mensaje aquí...",class:"w-full px-3 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500"},null,512),[[V,t(r).content]]),e("div",os," Caracteres: "+f(t(r).content.length),1)])])]),e("div",rs,[e("h3",as,[B(t(_e),{class:"h-5 w-5 mr-2 text-blue-600"}),s[21]||(s[21]=E(" Archivos Adjuntos ",-1)),e("span",ns," ("+f(t(o).length)+"/10) ",1)]),e("div",{onDrop:Z,onDragover:s[10]||(s[10]=Q(()=>{},["prevent"])),onDragenter:s[11]||(s[11]=Q(()=>{},["prevent"])),class:J(["border-2 border-dashed rounded-lg p-6 text-center transition-colors",t(m)?"border-blue-500 bg-blue-50":"border-gray-300"])},[B(t(pe),{class:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e("p",ls,[s[22]||(s[22]=E(" Arrastra archivos aquí o ",-1)),e("button",{onClick:s[9]||(s[9]=n=>c.$refs.fileInput?.click()),class:"text-blue-600 hover:text-blue-800 underline"}," selecciona archivos ")]),s[23]||(s[23]=e("p",{class:"text-xs text-gray-500"}," Máximo 50MB por archivo. Formatos: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, imágenes ",-1))],34),e("input",{ref:"fileInput",type:"file",multiple:"",accept:Hs,onChange:Y,class:"hidden"},null,544),t(o).length>0?(g(),y("div",is,[(g(!0),y(K,null,G(t(o),(n,S)=>(g(),y("div",{key:S,class:"flex items-center justify-between p-3 bg-gray-50 rounded-md"},[e("div",cs,[B(t(ve),{class:"h-5 w-5 text-gray-400 mr-2 flex-shrink-0"}),e("div",ds,[e("div",us,f(n.fileName),1),e("div",ms,[E(f(t(D)(n.fileSize))+" ",1),n.uploaded?(g(),y("span",fs,"✓ Subido")):n.uploading?(g(),y("span",gs,"⏳ Subiendo...")):n.error?(g(),y("span",ps,"❌ Error")):x("",!0)])])]),e("button",{onClick:k=>se(S),disabled:n.uploading,class:"text-red-600 hover:text-red-800 disabled:opacity-50"},[B(t(fe),{class:"h-4 w-4"})],8,vs)]))),128))])):x("",!0),t(R)>0&&t(R)<100?(g(),y("div",bs,[e("div",ys,"Subiendo archivos... "+f(t(R))+"%",1),e("div",hs,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all",style:ce({width:`${t(R)}%`})},null,4)])])):x("",!0)]),e("div",xs,[e("div",ws,[e("div",_s,[t(r).sendType==="single"?(g(),y("div",Es," Envío a: "+f(t(r).singleRecipient||"No especificado"),1)):x("",!0),t(r).sendType==="mass"?(g(),y("div",Cs," Envío masivo a "+f(t(r).selectedRecipients.length)+" contactos ",1)):x("",!0),t(o).length>0?(g(),y("div",ks," Con "+f(t(o).length)+" archivo(s) adjunto(s) ",1)):x("",!0)]),e("button",{onClick:te,disabled:!t(_)||t(a),class:"bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"},[B(t(be),{class:"h-5 w-5"}),t(a)?(g(),y("span",Ss,"Enviando...")):(g(),y("span",Ts,f(t(r).sendType==="mass"?"Enviar Masivo":"Enviar Email"),1))],8,$s)])])]),e("div",js,[e("div",Us,[s[28]||(s[28]=e("h3",{class:"text-lg font-semibold mb-4"},"Vista Previa",-1)),e("div",Rs,[e("div",null,[s[24]||(s[24]=e("strong",null,"De:",-1)),E(" "+f(t(h)?.email),1)]),e("div",null,[s[25]||(s[25]=e("strong",null,"Asunto:",-1)),E(" "+f(t(r).subject||"Sin asunto"),1)]),e("div",null,[s[26]||(s[26]=e("strong",null,"Destinatarios:",-1)),t(r).sendType==="single"?(g(),y("span",Ms,f(t(r).singleRecipient||"No especificado"),1)):x("",!0),t(r).sendType==="mass"?(g(),y("span",As,f(t(r).selectedRecipients.length)+" contactos ",1)):x("",!0)]),e("div",null,[s[27]||(s[27]=e("strong",null,"Adjuntos:",-1)),E(" "+f(t(o).length),1)])])]),e("div",Bs,[s[32]||(s[32]=e("h3",{class:"text-lg font-semibold mb-4"},"Estadísticas",-1)),e("div",Fs,[e("div",zs,[s[29]||(s[29]=e("span",null,"Total Contactos:",-1)),e("span",null,f(t(l).total),1)]),e("div",Ds,[s[30]||(s[30]=e("span",null,"Filtrados:",-1)),e("span",null,f(t(b).length),1)]),e("div",Ls,[s[31]||(s[31]=e("span",null,"Seleccionados:",-1)),e("span",null,f(t(r).selectedRecipients.length),1)])])]),s[33]||(s[33]=e("div",{class:"bg-white rounded-lg shadow p-6"},[e("h3",{class:"text-lg font-semibold mb-4"},"Historial"),e("div",{class:"text-sm text-gray-500"}," Últimos envíos aparecerán aquí ")],-1))])])]),t(C)?(g(),y("div",Ps,[e("div",Ns,[s[38]||(s[38]=e("h3",{class:"text-lg font-semibold mb-4"},"Confirmar Envío",-1)),e("div",Vs,[e("div",null,[s[34]||(s[34]=e("strong",null,"Tipo:",-1)),E(" "+f(t(r).sendType==="mass"?"Envío Masivo":"Envío Individual"),1)]),e("div",null,[s[35]||(s[35]=e("strong",null,"Destinatarios:",-1)),E(" "+f(t(r).sendType==="mass"?t(r).selectedRecipients.length:"1"),1)]),e("div",null,[s[36]||(s[36]=e("strong",null,"Asunto:",-1)),E(" "+f(t(r).subject),1)]),e("div",null,[s[37]||(s[37]=e("strong",null,"Adjuntos:",-1)),E(" "+f(t(o).length),1)])]),e("div",qs,[e("button",{onClick:s[12]||(s[12]=n=>C.value=!1),class:"flex-1 bg-gray-200 text-gray-800 py-2 rounded-md hover:bg-gray-300"}," Cancelar "),e("button",{onClick:oe,disabled:t(a),class:"flex-1 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 disabled:opacity-50"},f(t(a)?"Enviando...":"Confirmar Envío"),9,Is)])])])):x("",!0),t(v)?(g(),y("div",Os,[e("div",{class:J(["px-6 py-4 rounded-lg shadow-lg",t(d)==="success"?"bg-green-500 text-white":t(d)==="error"?"bg-red-500 text-white":"bg-blue-500 text-white"])},[e("div",Xs,[t(d)==="success"?(g(),I(t(ye),{key:0,class:"h-5 w-5"})):x("",!0),t(d)==="error"?(g(),I(t(he),{key:1,class:"h-5 w-5"})):x("",!0),t(d)==="info"?(g(),I(t(xe),{key:2,class:"h-5 w-5"})):x("",!0),e("span",null,f(t(i)),1)])],2)])):x("",!0)]))}}),nt=we(Ks,[["__scopeId","data-v-69b2a2be"]]);export{nt as default};
