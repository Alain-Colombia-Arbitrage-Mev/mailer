import{r as g,E as _,$ as M,a0 as k,n as v,q as T,A as B,c as m,a as s,k as w,s as o,t as z,j as D,l as E,v as A,J as h,d as S,o as c}from"#entry";import{u as C}from"./DMoW-9xf.js";import{_ as U}from"./DlAUqK2U.js";const V=()=>{const r=g(null),f=_(()=>!!r.value),i=g(!1),a=C();M();const d=async()=>{i.value=!0;try{{const t=localStorage.getItem("admin_bypass_session");if(t)try{const l=JSON.parse(t),I=new Date(l.timestamp);if((new Date().getTime()-I.getTime())/(1e3*60*60)<8)return console.log("Sesión bypass válida encontrada"),r.value=l.user,!0;console.log("Sesión bypass expirada, eliminando..."),localStorage.removeItem("admin_bypass_session")}catch(l){console.error("Error parseando sesión bypass:",l),localStorage.removeItem("admin_bypass_session")}}const{data:{session:n},error:u}=await a.auth.getSession();if(u)return console.error("Error obteniendo sesión:",u),r.value=null,!1;if(n?.user){const t=n.user.user_metadata;return t?.is_admin&&t?.role==="admin"?(r.value={id:n.user.id,email:n.user.email,name:t?.name||"Administrador",role:"admin",isAdmin:!0},!0):(console.warn("Usuario no tiene permisos de administrador"),r.value=null,!1)}return r.value=null,!1}catch(n){return console.error("Error verificando sesión:",n),r.value=null,!1}finally{i.value=!1}},b=async(n,u)=>{i.value=!0;try{let t;try{t=await $fetch("/api/auth/admin-login-bypass",{method:"POST",body:{email:n,password:u}}),console.log("Login bypass exitoso")}catch(l){console.log("Bypass falló, intentando con Supabase:",l),t=await $fetch("/api/auth/admin-login",{method:"POST",body:{email:n,password:u}})}if(t.success&&t.user){if(r.value=t.user,t.message?.includes("bypass")){const l={user:t.user,timestamp:new Date().toISOString(),type:"bypass"};localStorage.setItem("admin_bypass_session",JSON.stringify(l)),console.log("Sesión bypass guardada en localStorage")}else t.session&&await a.auth.setSession(t.session);return await v("/dashboard"),{success:!0,message:t.message}}return{success:!1,error:"Respuesta inválida del servidor"}}catch(t){console.error("Error en login:",t);let l="Error de conexión";return t.data?.statusMessage?l=t.data.statusMessage:t.statusMessage?l=t.statusMessage:t.message&&(l=t.message),{success:!1,error:l}}finally{i.value=!1}},x=async()=>{i.value=!0;try{return localStorage.removeItem("admin_bypass_session"),console.log("Sesión bypass eliminada de localStorage"),await a.auth.signOut(),r.value=null,await v("/auth/admin-login"),{success:!0}}catch(n){return console.error("Error en logout:",n),localStorage.removeItem("admin_bypass_session"),r.value=null,await v("/auth/admin-login"),{success:!1,error:"Error al cerrar sesión"}}finally{i.value=!1}},y=_(()=>r.value?.role==="admin"&&r.value?.isAdmin===!0),p=()=>({id:r.value?.id,email:r.value?.email,name:r.value?.name,role:r.value?.role,isAdmin:r.value?.isAdmin,loginTime:r.value?.loginTime}),e=async()=>{await d()};return{user:k(r),isAuthenticated:f,isLoading:k(i),isAdmin:y,login:b,logout:x,checkSession:d,initialize:e,getUserInfo:p}},L={style:{"min-height":"100vh",display:"flex","align-items":"center","justify-content":"center",background:"linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%)",padding:"20px","font-family":"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif"}},O={style:{background:"white",padding:"40px","border-radius":"16px","box-shadow":"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",border:"1px solid #e5e7eb",width:"100%","max-width":"400px"}},j={style:{"text-align":"center"}},N={style:{width:"48px",height:"48px",background:"#dbeafe","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center",margin:"0 auto 24px auto"}},P={style:{width:"32px",height:"32px",color:"#3b82f6"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},q={key:0,style:{background:"#fef2f2",border:"1px solid #fecaca","border-radius":"8px",padding:"16px","margin-bottom":"20px"}},J={style:{"font-size":"14px",color:"#dc2626"}},R={style:{"margin-bottom":"20px"}},$=["disabled"],F={style:{"margin-bottom":"20px"}},H=["disabled"],G=["disabled"],K={key:0,style:{width:"20px",height:"20px",border:"2px solid #ffffff","border-top":"2px solid transparent","border-radius":"50%",animation:"spin 1s linear infinite","margin-right":"8px"}},Q={key:1,style:{background:"#fffbeb",border:"1px solid #fed7aa","border-radius":"8px",padding:"16px","margin-top":"24px"}},W=T({__name:"admin-login",setup(r){const{login:f,isLoading:i}=V(),a=g({email:"",password:""}),d=g(""),b=_(()=>!1),x=async()=>{if(d.value="",!a.value.email||!a.value.password){d.value="Por favor, completa todos los campos";return}try{const p=await f(a.value.email,a.value.password);p.success||(d.value=p.error||"Error desconocido")}catch(p){console.error("Error en login:",p),d.value="Error de conexión. Intenta nuevamente."}},y=()=>{a.value.email="info@be-mindpower.net",a.value.password="Be-mind.2025+++"};return B([()=>a.value.email,()=>a.value.password],()=>{d.value&&(d.value="")}),(p,e)=>(c(),m("div",L,[s("div",O,[s("div",j,[s("div",N,[(c(),m("svg",P,[...e[2]||(e[2]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"},null,-1)])]))]),e[3]||(e[3]=s("h2",{style:{margin:"24px 0 8px 0","font-size":"30px","font-weight":"800",color:"#111827"}},"Acceso Administrativo",-1)),e[4]||(e[4]=s("p",{style:{margin:"8px 0","font-size":"14px",color:"#6b7280"}},"Sistema de Email Marketing Be-Mindpower",-1))]),o(d)?(c(),m("div",q,[e[5]||(e[5]=s("div",{style:{"font-size":"14px","font-weight":"500",color:"#991b1b","margin-bottom":"8px"}},"Error de autenticación",-1)),s("div",J,z(o(d)),1)])):w("",!0),s("form",{onSubmit:D(x,["prevent"])},[s("div",R,[e[6]||(e[6]=s("label",{for:"email",style:{display:"block","font-size":"14px","font-weight":"500",color:"#374151","margin-bottom":"4px"}},"Email del administrador",-1)),E(s("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=n=>o(a).email=n),name:"email",type:"email",autocomplete:"email",required:"",disabled:o(i),style:h([{width:"100%",padding:"12px 16px",border:"1px solid #d1d5db","border-radius":"8px","font-size":"14px",color:"#111827",background:"white",transition:"all 0.2s","box-sizing":"border-box"},{opacity:o(i)?.5:1,cursor:o(i)?"not-allowed":"text"}]),placeholder:"Ingresa tu email"},null,12,$),[[A,o(a).email]])]),s("div",F,[e[7]||(e[7]=s("label",{for:"password",style:{display:"block","font-size":"14px","font-weight":"500",color:"#374151","margin-bottom":"4px"}},"Contraseña",-1)),E(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=n=>o(a).password=n),name:"password",type:"password",autocomplete:"current-password",required:"",disabled:o(i),style:h([{width:"100%",padding:"12px 16px",border:"1px solid #d1d5db","border-radius":"8px","font-size":"14px",color:"#111827",background:"white",transition:"all 0.2s","box-sizing":"border-box"},{opacity:o(i)?.5:1,cursor:o(i)?"not-allowed":"text"}]),placeholder:"Ingresa tu contraseña"},null,12,H),[[A,o(a).password]])]),s("button",{type:"submit",disabled:o(i)||!o(a).email||!o(a).password,style:h([{width:"100%",padding:"12px 16px",background:"#3b82f6",color:"white",border:"none","border-radius":"8px","font-size":"14px","font-weight":"500",cursor:"pointer",transition:"all 0.2s",display:"flex","align-items":"center","justify-content":"center"},{opacity:o(i)||!o(a).email||!o(a).password?.5:1,cursor:o(i)||!o(a).email||!o(a).password?"not-allowed":"pointer",background:(o(i)||!o(a).email||!o(a).password,"#3b82f6")}])},[o(i)?(c(),m("div",K)):w("",!0),S(" "+z(o(i)?"Verificando...":"Iniciar Sesión"),1)],12,G)],32),e[11]||(e[11]=s("div",{style:{"text-align":"center","margin-top":"20px"}},[s("p",{style:{margin:"8px 0","font-size":"14px",color:"#6b7280"}},"Solo administradores autorizados"),s("p",{style:{margin:"8px 0","font-size":"14px",color:"#6b7280"}},"El registro público está deshabilitado")],-1)),o(b)?(c(),m("div",Q,[e[8]||(e[8]=s("h4",{style:{"font-size":"14px","font-weight":"500",color:"#92400e","margin-bottom":"8px"}},"Variables de entorno:",-1)),e[9]||(e[9]=s("p",{style:{"font-size":"12px",color:"#a16207",margin:"4px 0","text-align":"left"}},[s("strong",null,"username_mailer:"),S(" info@be-mindpower.net")],-1)),e[10]||(e[10]=s("p",{style:{"font-size":"12px",color:"#a16207",margin:"4px 0","text-align":"left"}},[s("strong",null,"password_mailer:"),S(" Be-mind.2025+++")],-1)),s("button",{onClick:y,style:{background:"none",border:"none",color:"#d97706","text-decoration":"underline",cursor:"pointer","font-size":"12px","margin-top":"8px"}}," Usar credenciales por defecto ")])):w("",!0),e[12]||(e[12]=s("div",{style:{"text-align":"center","margin-top":"20px"}},[s("a",{href:"/register-admin",style:{color:"#3b82f6","text-decoration":"none","font-size":"14px"}}," ¿Primera vez? Registrar usuario admin → ")],-1))])]))}}),oe=U(W,[["__scopeId","data-v-fd2a9fde"]]);export{oe as default};
