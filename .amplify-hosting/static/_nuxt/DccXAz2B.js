import{_ as S}from"./B8aq_QmG.js";import{c as o,o as r,a as e,q as z,r as x,h as V,k as v,b as g,w as T,m as P,s,d as h,t as n,l as f,y as k,v as U,F as w,g as C,G as j}from"#entry";import{r as G}from"./CesKVqSv.js";import{r as $}from"./DWNj0d99.js";function L(E,i){return r(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m6.75 12-3-3m0 0-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}const X={class:"space-y-6"},H={class:"sm:flex sm:items-center sm:justify-between"},O={class:"mt-4 sm:mt-0"},R={class:"card"},J={class:"card-body"},K={class:"space-y-6"},Z={class:"text-center"},Q={class:"text-sm text-gray-600 mb-2"},W={key:0,class:"mt-4 bg-gray-50 p-4 rounded-lg"},Y={class:"flex items-center justify-between"},ee={class:"flex items-center"},te={class:"text-sm text-gray-900"},se={class:"text-xs text-gray-500 ml-2"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ae={class:"space-y-3"},oe={class:"flex items-center"},re={class:"flex items-center"},ne={class:"flex items-center"},ie={key:0,class:"space-y-4"},de={class:"overflow-x-auto"},ce={class:"table"},ue={class:"table-body"},me={class:"table-cell"},pe={class:"font-medium"},xe={key:0,class:"text-red-500 ml-1"},ve={class:"table-cell"},be=["onUpdate:modelValue"],ye=["value"],fe={class:"table-cell"},ge={class:"text-sm text-gray-600"},_e={class:"flex justify-end space-x-3"},he=["disabled"],ke=["disabled"],we={key:0,class:"spinner mr-2"},Ce={key:0,class:"card"},Be={class:"card-body"},Ve={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},Ee={class:"text-center"},Ne={class:"text-2xl font-bold text-blue-600"},Me={class:"text-center"},Fe={class:"text-2xl font-bold text-green-600"},qe={class:"text-center"},Ae={class:"text-2xl font-bold text-yellow-600"},Ie={class:"text-center"},De={class:"text-2xl font-bold text-red-600"},Se={key:0,class:"space-y-2"},ze={class:"max-h-60 overflow-y-auto"},Ge=z({__name:"import",setup(E){const i=x(null),u=x(!1),N=x(!1),d=x([]),_=x([]),c=x(null),m=V({skipDuplicates:!0,updateExisting:!1,validateEmails:!0,defaultBalance:0}),p=V({}),M=[{key:"firstName",label:"Nombre",required:!0},{key:"lastName",label:"Apellido",required:!0},{key:"email",label:"Email",required:!0},{key:"username",label:"Usuario",required:!1},{key:"phoneNumber",label:"Teléfono",required:!1},{key:"Gender",label:"Género",required:!1},{key:"birthday",label:"Fecha de Nacimiento",required:!1},{key:"Balance",label:"Balance",required:!1}],F=a=>{const t=a.target;t.files&&t.files[0]&&(i.value=t.files[0],c.value=null,d.value=[])},q=a=>{if(a===0)return"0 Bytes";const t=1024,b=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,l)).toFixed(2))+" "+b[l]},A=async()=>{if(i.value){u.value=!0;try{await new Promise(a=>setTimeout(a,1e3)),_.value=["Nombre","Apellido","Email","Teléfono","Balance"],d.value=[{Nombre:"Juan",Apellido:"Pérez",Email:"juan@example.com",Teléfono:"123456789",Balance:"100"},{Nombre:"María",Apellido:"García",Email:"maria@example.com",Teléfono:"987654321",Balance:"200"}],p.firstName=0,p.lastName=1,p.email=2,p.phoneNumber=3,p.Balance=4}catch(a){console.error("Error processing file:",a)}finally{u.value=!1}}},I=a=>{const t=p[a];if(t!==void 0&&d.value.length>0){const b=_.value[t];return d.value[0][b]||"-"}return"-"},D=async()=>{if(!(!i.value||d.value.length===0)){u.value=!0;try{await new Promise(a=>setTimeout(a,2e3)),c.value={total:d.value.length,imported:d.value.length-1,updated:0,errors:1,errorDetails:[{row:2,message:"Email duplicado: maria@example.com"}]}}catch(a){console.error("Error importing contacts:",a)}finally{u.value=!1}}};return(a,t)=>{const b=S;return r(),o("div",X,[e("div",H,[t[7]||(t[7]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Importar Contactos"),e("p",{class:"mt-1 text-sm text-gray-500"}," Importa usuarios desde archivos CSV o Excel ")],-1)),e("div",O,[g(b,{to:"/contacts",class:"btn btn-outline"},{default:T(()=>[...t[6]||(t[6]=[h(" ← Volver a Contactos ",-1)])]),_:1})])]),e("div",R,[e("div",J,[e("div",K,[e("div",null,[t[10]||(t[10]=e("label",{class:"form-label"},"Archivo de Contactos",-1)),e("div",{class:P(["dropzone",{"dropzone-active":s(N)}])},[e("input",{ref:"fileInput",type:"file",accept:".csv,.xlsx,.xls",onChange:F,class:"hidden"},null,544),e("div",Z,[g(s(L),{class:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e("p",Q,[t[8]||(t[8]=h(" Arrastra un archivo CSV o Excel aquí, o ",-1)),e("button",{onClick:t[0]||(t[0]=l=>a.$refs.fileInput.click()),class:"text-blue-600 hover:text-blue-500"}," selecciona un archivo ")]),t[9]||(t[9]=e("p",{class:"text-xs text-gray-500"}," Formatos soportados: CSV, XLSX, XLS (máximo 10MB) ",-1))])],2),s(i)?(r(),o("div",W,[e("div",Y,[e("div",ee,[g(s(G),{class:"w-5 h-5 text-gray-400 mr-2"}),e("span",te,n(s(i).name),1),e("span",se,"("+n(q(s(i).size))+")",1)]),e("button",{onClick:t[1]||(t[1]=l=>i.value=null),class:"text-red-600 hover:text-red-500"},[g(s($),{class:"w-4 h-4"})])])])):v("",!0)]),e("div",le,[e("div",null,[t[14]||(t[14]=e("label",{class:"form-label"},"Configuración de Importación",-1)),e("div",ae,[e("label",oe,[f(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s(m).skipDuplicates=l),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[k,s(m).skipDuplicates]]),t[11]||(t[11]=e("span",{class:"ml-2 text-sm text-gray-700"},"Omitir duplicados",-1))]),e("label",re,[f(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s(m).updateExisting=l),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[k,s(m).updateExisting]]),t[12]||(t[12]=e("span",{class:"ml-2 text-sm text-gray-700"},"Actualizar existentes",-1))]),e("label",ne,[f(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>s(m).validateEmails=l),type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,512),[[k,s(m).validateEmails]]),t[13]||(t[13]=e("span",{class:"ml-2 text-sm text-gray-700"},"Validar emails",-1))])])]),e("div",null,[t[15]||(t[15]=e("label",{class:"form-label"},"Balance Inicial",-1)),f(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>s(m).defaultBalance=l),type:"number",min:"0",step:"0.01",class:"input",placeholder:"0.00"},null,512),[[U,s(m).defaultBalance,void 0,{number:!0}]]),t[16]||(t[16]=e("p",{class:"form-help"},"Balance inicial para nuevos usuarios",-1))])]),s(d).length>0?(r(),o("div",ie,[t[19]||(t[19]=e("h3",{class:"text-lg font-medium text-gray-900"},"Vista Previa y Mapeo de Columnas",-1)),e("div",de,[e("table",ce,[t[18]||(t[18]=e("thead",{class:"table-header"},[e("tr",null,[e("th",{class:"table-header-cell"},"Campo"),e("th",{class:"table-header-cell"},"Columna del Archivo"),e("th",{class:"table-header-cell"},"Vista Previa")])],-1)),e("tbody",ue,[(r(),o(w,null,C(M,l=>e("tr",{key:l.key,class:"table-row"},[e("td",me,[e("span",pe,n(l.label),1),l.required?(r(),o("span",xe,"*")):v("",!0)]),e("td",ve,[f(e("select",{"onUpdate:modelValue":y=>s(p)[l.key]=y,class:"input"},[t[17]||(t[17]=e("option",{value:""},"-- Seleccionar columna --",-1)),(r(!0),o(w,null,C(s(_),(y,B)=>(r(),o("option",{key:B,value:B},n(y),9,ye))),128))],8,be),[[j,s(p)[l.key]]])]),e("td",fe,[e("span",ge,n(I(l.key)),1)])])),64))])])])])):v("",!0),e("div",_e,[e("button",{onClick:A,disabled:!s(i)||s(u),class:"btn btn-secondary"}," Vista Previa ",8,he),e("button",{onClick:D,disabled:!s(i)||s(u)||s(d).length===0,class:"btn btn-primary"},[s(u)?(r(),o("span",we)):v("",!0),h(" "+n(s(u)?"Importando...":"Importar Contactos"),1)],8,ke)])])])]),s(c)?(r(),o("div",Ce,[t[25]||(t[25]=e("div",{class:"card-header"},[e("h3",{class:"text-lg font-medium text-gray-900"},"Resultados de Importación")],-1)),e("div",Be,[e("div",Ve,[e("div",Ee,[e("div",Ne,n(s(c).total),1),t[20]||(t[20]=e("div",{class:"text-sm text-gray-500"},"Total",-1))]),e("div",Me,[e("div",Fe,n(s(c).imported),1),t[21]||(t[21]=e("div",{class:"text-sm text-gray-500"},"Importados",-1))]),e("div",qe,[e("div",Ae,n(s(c).updated),1),t[22]||(t[22]=e("div",{class:"text-sm text-gray-500"},"Actualizados",-1))]),e("div",Ie,[e("div",De,n(s(c).errors),1),t[23]||(t[23]=e("div",{class:"text-sm text-gray-500"},"Errores",-1))])]),s(c).errorDetails.length>0?(r(),o("div",Se,[t[24]||(t[24]=e("h4",{class:"font-medium text-gray-900"},"Errores Detallados:",-1)),e("div",ze,[(r(!0),o(w,null,C(s(c).errorDetails,(l,y)=>(r(),o("div",{key:y,class:"text-sm text-red-600 bg-red-50 p-2 rounded"}," Fila "+n(l.row)+": "+n(l.message),1))),128))])])):v("",!0)])])):v("",!0)])}}});export{Ge as default};
