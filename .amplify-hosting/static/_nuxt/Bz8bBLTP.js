const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CL2yjAnz.js","./D59wPe2Q.js"])))=>i.map(i=>d[i]);
import{r as i,E as I,e as K,u as J,f as X,w as V,_ as z,o as u,a as e,c,k as $,d as f,t as l,F as C,g as E,l as p,I as Q,v as y,b as W,y as Y,D as Z}from"#entry";import{_ as ee}from"./B8aq_QmG.js";import{_ as te}from"./Dyv7dZ9s.js";const se={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8"},oe={class:"mt-4 sm:mt-0 flex space-x-3"},le=["disabled"],ae=["disabled"],re={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},ne={class:"lg:col-span-2 space-y-6"},ie={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-200"},de={class:"space-y-4"},ue={class:"flex flex-wrap gap-2 mb-2"},ce=["onClick"],me={class:"flex space-x-2"},ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},be={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-200"},pe={class:"space-y-4"},ge={class:"border border-gray-300 rounded-md"},xe={class:"bg-gray-50 px-3 py-2 border-b border-gray-300 flex items-center space-x-2"},fe={class:"text-xs text-gray-500 mt-1"},ye={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-200"},he={class:"space-y-4"},we={class:"flex items-center justify-center w-full"},_e={class:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100"},ke={key:0,class:"space-y-2"},Ce={class:"flex items-center"},Ee={class:"text-sm text-gray-700"},je=["onClick"],Me={class:"space-y-6"},Be={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-200"},Se={class:"space-y-3 text-sm"},Pe={class:"text-gray-900"},Ne={class:"text-gray-900"},Ve={class:"text-gray-900"},ze={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-200"},$e={class:"space-y-2"},Le=["onClick"],Ae={class:"font-medium text-gray-900"},De={class:"text-sm text-gray-600 truncate"},Te={class:"bg-white p-6 rounded-lg shadow-sm border border-gray-200"},He={class:"space-y-3"},Re={class:"flex justify-between text-sm"},Fe={class:"font-medium text-gray-900"},Ue={class:"flex justify-between text-sm"},qe={class:"font-medium text-gray-900"},Ge={class:"flex justify-between text-sm"},Oe={class:"font-medium text-gray-900"},Ie={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},Ke={class:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-2/3 shadow-lg rounded-md bg-white"},Je={class:"mt-3"},Xe={class:"max-h-96 overflow-y-auto"},Qe={class:"space-y-2"},We=["id","value"],Ye=["for"],Ze={class:"font-medium text-gray-900"},et={class:"text-sm text-gray-600"},tt={class:"flex justify-end space-x-3 mt-6"},nt={__name:"compose",setup(st){const d=i([]),v=i(""),m=i([]),h=i(!1),w=i(!1),_=i(!1),g=i([]),j=i([]),S=i([]),x=i(null),a=i({subject:"",content:"",cc:"",bcc:""}),k=i({todayEmails:0,totalContacts:0,openRate:0}),P=I(()=>d.value.length>0&&a.value.subject&&a.value.content),N=()=>{v.value&&!d.value.includes(v.value)&&(d.value.push(v.value),v.value="")},L=s=>{d.value=d.value.filter(t=>t!==s)},A=()=>{g.value.forEach(s=>{d.value.includes(s)||d.value.push(s)}),g.value=[],_.value=!1},D=s=>{Array.from(s.target.files).forEach(r=>{r.size<=10*1024*1024?m.value.push(r):alert(`El archivo ${r.name} es demasiado grande. Máximo 10MB.`)})},T=s=>{m.value.splice(s,1)},H=s=>{if(s===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,n)).toFixed(2))+" "+r[n]},M=s=>{document.execCommand(s,!1,null)},B=s=>{if(x.value){const t=x.value.selectionStart,r=a.value.content.substring(0,t),n=a.value.content.substring(t);a.value.content=r+`{{${s}}}`+n,Z(()=>{x.value.setSelectionRange(t+s.length+4,t+s.length+4),x.value.focus()})}},R=s=>{a.value.subject=s.subject,a.value.content=s.html_content||s.text_content||""},F=async()=>{if(P.value)try{h.value=!0;const s=new FormData;s.append("recipients",JSON.stringify(d.value)),s.append("subject",a.value.subject),s.append("content",a.value.content),s.append("cc",a.value.cc),s.append("bcc",a.value.bcc),m.value.forEach((r,n)=>{s.append(`attachment_${n}`,r)});const t=await $fetch("/api/emails/send",{method:"POST",body:s});if(t.success)alert("¡Email enviado exitosamente!"),d.value=[],a.value={subject:"",content:"",cc:"",bcc:""},m.value=[];else throw new Error(t.message||"Error al enviar email")}catch(s){console.error("Error sending email:",s),alert("Error al enviar el email: "+s.message)}finally{h.value=!1}},U=async()=>{try{w.value=!0,await new Promise(s=>setTimeout(s,1e3)),alert("Borrador guardado exitosamente")}catch(s){console.error("Error saving draft:",s),alert("Error al guardar borrador")}finally{w.value=!1}},q=async()=>{try{const{useSupabase:s}=await z(async()=>{const{useSupabase:o}=await import("./CL2yjAnz.js");return{useSupabase:o}},__vite__mapDeps([0,1]),import.meta.url),t=s(),{data:r,error:n}=await t.from("USERS").select("idPerson, firstName, lastName, email").limit(100);if(n){console.error("Error loading contacts:",n);return}j.value=r||[]}catch(s){console.error("Error:",s)}},G=async()=>{try{const{useSupabase:s}=await z(async()=>{const{useSupabase:o}=await import("./CL2yjAnz.js");return{useSupabase:o}},__vite__mapDeps([0,1]),import.meta.url),t=s(),{data:r,error:n}=await t.from("email_templates").select("id, name, subject, html_content, text_content").eq("is_active",!0).limit(5);if(n){console.error("Error loading templates:",n);return}S.value=r||[]}catch(s){console.error("Error:",s)}},O=async()=>{try{k.value={todayEmails:12,totalContacts:j.value.length,openRate:68.5}}catch(s){console.error("Error loading stats:",s)}};return K(()=>{q(),G(),O()}),J({title:"Componer Email - MailPower"}),(s,t)=>{const r=ee,n=te;return u(),X(n,{name:"default"},{default:V(()=>[e("div",null,[e("div",se,[t[16]||(t[16]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Componer Email"),e("p",{class:"mt-2 text-gray-600"},"Crea y envía emails personalizados a tus contactos")],-1)),e("div",oe,[e("button",{onClick:U,disabled:w.value,class:"inline-flex items-center px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-lg hover:bg-gray-700 transition-colors disabled:opacity-50"},[t[14]||(t[14]=e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"})],-1)),f(" "+l(w.value?"Guardando...":"Guardar Borrador"),1)],8,le),e("button",{onClick:F,disabled:!P.value||h.value,class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50"},[t[15]||(t[15]=e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)),f(" "+l(h.value?"Enviando...":"Enviar Email"),1)],8,ae)])]),e("div",re,[e("div",ne,[e("div",ie,[t[21]||(t[21]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Destinatarios",-1)),e("div",de,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Para:",-1)),e("div",ue,[(u(!0),c(C,null,E(d.value,o=>(u(),c("span",{key:o,class:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800"},[f(l(o)+" ",1),e("button",{onClick:b=>L(o),class:"ml-2 text-blue-600 hover:text-blue-800"},[...t[17]||(t[17]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])],8,ce)]))),128))]),e("div",me,[p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>v.value=o),type:"email",placeholder:"Agregar email...",class:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeypress:Q(N,["enter"])},null,544),[[y,v.value]]),e("button",{onClick:N,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700"}," Agregar "),e("button",{onClick:t[1]||(t[1]=o=>_.value=!0),class:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-md hover:bg-green-700"}," Seleccionar Contactos ")])]),e("div",ve,[e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"CC:",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.cc=o),type:"email",placeholder:"Emails separados por comas",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,a.value.cc]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"BCC:",-1)),p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.bcc=o),type:"email",placeholder:"Emails separados por comas",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,a.value.bcc]])])])])]),e("div",be,[t[28]||(t[28]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Contenido del Email",-1)),e("div",pe,[e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Asunto:",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>a.value.subject=o),type:"text",required:"",placeholder:"Escribe el asunto del email",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[y,a.value.subject]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Mensaje:",-1)),e("div",ge,[e("div",xe,[e("button",{onClick:t[5]||(t[5]=o=>M("bold")),class:"p-1 rounded hover:bg-gray-200",type:"button"},[...t[23]||(t[23]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M3 5a1 1 0 011-1h5.5a2.5 2.5 0 010 5H4v2h5.5a2.5 2.5 0 010 5H4a1 1 0 01-1-1V5z"})],-1)])]),e("button",{onClick:t[6]||(t[6]=o=>M("italic")),class:"p-1 rounded hover:bg-gray-200",type:"button"},[...t[24]||(t[24]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M8.25 3.75H12a.75.75 0 010 1.5h-1.136l-2.727 10.5H9.75a.75.75 0 010 1.5H6a.75.75 0 010-1.5h1.136L9.863 5.25H8.25a.75.75 0 010-1.5z"})],-1)])]),e("button",{onClick:t[7]||(t[7]=o=>M("underline")),class:"p-1 rounded hover:bg-gray-200",type:"button"},[...t[25]||(t[25]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{d:"M3 19a1 1 0 100-2h14a1 1 0 100 2H3zM6.5 4.5a1 1 0 00-2 0v5a4.5 4.5 0 009 0v-5a1 1 0 00-2 0v5a2.5 2.5 0 01-5 0v-5z"})],-1)])]),t[26]||(t[26]=e("div",{class:"border-l border-gray-300 h-4 mx-2"},null,-1)),e("button",{onClick:t[8]||(t[8]=o=>B("firstName")),class:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded hover:bg-blue-200",type:"button"},l(s.firstName),1),e("button",{onClick:t[9]||(t[9]=o=>B("lastName")),class:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded hover:bg-blue-200",type:"button"},l(s.lastName),1),e("button",{onClick:t[10]||(t[10]=o=>B("email")),class:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded hover:bg-blue-200",type:"button"},l(s.email),1)]),p(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=o=>a.value.content=o),ref_key:"contentEditor",ref:x,rows:"12",required:"",placeholder:"Escribe tu mensaje aquí...",class:"w-full px-3 py-2 resize-y focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 border-0"},null,512),[[y,a.value.content]])]),e("p",fe," Puedes usar variables como "+l(s.firstName)+", "+l(s.lastName)+", "+l(s.email)+" para personalizar el mensaje ",1)])])]),e("div",ye,[t[32]||(t[32]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Archivos Adjuntos",-1)),e("div",he,[e("div",we,[e("label",_e,[t[29]||(t[29]=e("div",{class:"flex flex-col items-center justify-center pt-5 pb-6"},[e("svg",{class:"w-8 h-8 mb-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),e("p",{class:"mb-2 text-sm text-gray-500"},[e("span",{class:"font-semibold"},"Click para subir"),f(" o arrastra archivos aquí ")]),e("p",{class:"text-xs text-gray-500"},"PNG, JPG, PDF, DOC (MAX. 10MB)")],-1)),e("input",{type:"file",class:"hidden",multiple:"",accept:".png,.jpg,.jpeg,.pdf,.doc,.docx,.txt",onChange:D},null,32)])]),m.value.length>0?(u(),c("div",ke,[(u(!0),c(C,null,E(m.value,(o,b)=>(u(),c("div",{key:b,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[e("div",Ce,[t[30]||(t[30]=e("svg",{class:"w-5 h-5 text-gray-400 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)),e("span",Ee,l(o.name)+" ("+l(H(o.size))+")",1)]),e("button",{onClick:ot=>T(b),class:"text-red-600 hover:text-red-800"},[...t[31]||(t[31]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])],8,je)]))),128))])):$("",!0)])])]),e("div",Me,[e("div",Be,[t[36]||(t[36]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Vista Previa",-1)),e("div",Se,[e("div",null,[t[33]||(t[33]=e("span",{class:"font-medium text-gray-600"},"Para:",-1)),e("span",Pe,l(d.value.length)+" destinatario(s)",1)]),e("div",null,[t[34]||(t[34]=e("span",{class:"font-medium text-gray-600"},"Asunto:",-1)),e("span",Ne,l(a.value.subject||"Sin asunto"),1)]),e("div",null,[t[35]||(t[35]=e("span",{class:"font-medium text-gray-600"},"Archivos:",-1)),e("span",Ve,l(m.value.length)+" archivo(s)",1)])])]),e("div",ze,[t[38]||(t[38]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Plantillas",-1)),e("div",$e,[(u(!0),c(C,null,E(S.value,o=>(u(),c("button",{key:o.id,onClick:b=>R(o),class:"w-full text-left p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors"},[e("div",Ae,l(o.name),1),e("div",De,l(o.subject),1)],8,Le))),128)),W(r,{to:"/templates",class:"block w-full text-center p-3 text-blue-600 hover:text-blue-800 text-sm font-medium"},{default:V(()=>[...t[37]||(t[37]=[f(" Ver todas las plantillas → ",-1)])]),_:1})])]),e("div",Te,[t[42]||(t[42]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Estadísticas",-1)),e("div",He,[e("div",Re,[t[39]||(t[39]=e("span",{class:"text-gray-600"},"Emails enviados hoy:",-1)),e("span",Fe,l(k.value.todayEmails),1)]),e("div",Ue,[t[40]||(t[40]=e("span",{class:"text-gray-600"},"Total contactos:",-1)),e("span",qe,l(k.value.totalContacts),1)]),e("div",Ge,[t[41]||(t[41]=e("span",{class:"text-gray-600"},"Tasa de apertura:",-1)),e("span",Oe,l(k.value.openRate)+"%",1)])])])])])]),_.value?(u(),c("div",Ie,[e("div",Ke,[e("div",Je,[t[43]||(t[43]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Seleccionar Contactos",-1)),e("div",Xe,[e("div",Qe,[(u(!0),c(C,null,E(j.value,o=>(u(),c("div",{key:o.idPerson,class:"flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50"},[p(e("input",{type:"checkbox",id:`contact-${o.idPerson}`,value:o.email,"onUpdate:modelValue":t[12]||(t[12]=b=>g.value=b),class:"mr-3 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,8,We),[[Y,g.value]]),e("label",{for:`contact-${o.idPerson}`,class:"flex-1 cursor-pointer"},[e("div",Ze,l(o.firstName)+" "+l(o.lastName),1),e("div",et,l(o.email),1)],8,Ye)]))),128))])]),e("div",tt,[e("button",{onClick:t[13]||(t[13]=o=>_.value=!1),class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md"}," Cancelar "),e("button",{onClick:A,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md"}," Agregar Seleccionados ("+l(g.value.length)+") ",1)])])])])):$("",!0)]),_:1})}}};export{nt as default};
