import{u as x}from"./BcbNczkL.js";import{q as _,r as n,e as h,n as f,A as y,B as k,c as r,a as t,k as S,s as o,t as g,b as p,o as l}from"#entry";import{r as A}from"./B2LZCxKM.js";import{r as w}from"./BAcWvHoW.js";import{_ as E}from"./DlAUqK2U.js";const M={class:"min-h-screen flex items-center justify-center bg-gray-50"},I={class:"text-center"},C={key:0,class:"space-y-4"},N={class:"text-gray-600"},V={key:1,class:"space-y-4"},B={class:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-red-100"},D={class:"text-red-600 mb-4"},T={key:2,class:"space-y-4"},L={class:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-green-100"},j=_({__name:"callback",setup(P){const a=n(!0),c=n(!1),i=n(""),u=n("Verificando tu Magic Link..."),{supabaseUser:b,supabaseSession:d,correctSupabaseClient:v}=x();return h(async()=>{try{console.log("🔄 Iniciando callback de Magic Link..."),u.value="Procesando Magic Link...";const{data:e,error:s}=await v.auth.getSession();if(s){console.error("❌ Error obteniendo sesión:",s),i.value=s.message,a.value=!1;return}if(e.session&&e.session.user){console.log("✅ Usuario autenticado via callback:",e.session.user.email),u.value="Configurando sesión...";{const m={user:{id:e.session.user.id,email:e.session.user.email,name:e.session.user.user_metadata?.full_name||e.session.user.email,isAdmin:e.session.user.email==="info@be-mindpower.net"},session:e.session,timestamp:Date.now(),isAuthenticated:!0};localStorage.setItem("admin_session",JSON.stringify(m)),localStorage.setItem("auth_status","authenticated")}c.value=!0,a.value=!1,setTimeout(()=>{f("/dashboard")},1500);return}setTimeout(()=>{a.value&&(console.error("❌ Timeout - No se detectó sesión válida"),i.value="El enlace de acceso ha expirado o es inválido. Intenta generar uno nuevo.",a.value=!1)},5e3)}catch(e){console.error("❌ Error en callback:",e),i.value=e.message||"Error procesando el enlace de acceso",a.value=!1}}),y(b,e=>{if(e&&a.value){if(console.log("👤 Usuario detectado:",e.email),c.value=!0,a.value=!1,d.value){const s={user:{id:e.id,email:e.email,name:"Administrador",isAdmin:!0},session:d.value,timestamp:Date.now(),isAuthenticated:!0};localStorage.setItem("admin_session",JSON.stringify(s)),localStorage.setItem("auth_status","authenticated")}setTimeout(()=>{f("/dashboard")},1500)}},{immediate:!0}),k({title:"Verificando Acceso - Mailer Be-Mindpower"}),(e,s)=>(l(),r("div",M,[t("div",I,[o(a)?(l(),r("div",C,[s[1]||(s[1]=t("div",{class:"spinner-lg mb-4"},null,-1)),s[2]||(s[2]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-2"}," Procesando autenticación... ",-1)),t("p",N,g(o(u)),1)])):o(i)?(l(),r("div",V,[t("div",B,[p(o(A),{class:"h-6 w-6 text-red-600"})]),s[3]||(s[3]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-2"}," Error de Autenticación ",-1)),t("p",D,g(o(i)),1),t("button",{onClick:s[0]||(s[0]=m=>e.$router.push("/login")),class:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700"}," Volver al Login ")])):o(c)?(l(),r("div",T,[t("div",L,[p(o(w),{class:"h-6 w-6 text-green-600"})]),s[4]||(s[4]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-2"}," ¡Autenticación Exitosa! ",-1)),s[5]||(s[5]=t("p",{class:"text-green-600"}," Redirigiendo al dashboard... ",-1))])):S("",!0)])]))}}),z=E(j,[["__scopeId","data-v-7bff858b"]]);export{z as default};
